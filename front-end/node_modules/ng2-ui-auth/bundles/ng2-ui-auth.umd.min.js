!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@angular/common/http")):"function"==typeof define&&define.amd?define("ng2-ui-auth",["exports","@angular/core","rxjs","rxjs/operators","@angular/common/http"],e):e(t["ng2-ui-auth"]={},t.ng.core,t.rxjs,t.rxjs.operators,t.ng.common.http)}(this,function(t,n,c,h,i){"use strict";var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};var d=Object.assign||function d(t){for(var e,o=1,r=arguments.length;o<r;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t};function o(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var r,n,i=o.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)a.push(r.value)}catch(s){n={error:s}}finally{try{r&&!r.done&&(o=i["return"])&&o.call(i)}finally{if(n)throw n.error}}return a}function l(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(o(arguments[e]));return t}var s={NONE:"none",MEMORY:"memory",LOCAL_STORAGE:"localStorage",SESSION_STORAGE:"sessionStorage",COOKIE:"cookie",SESSION_COOKIE:"sessionCookie"};function f(t,e){return/^(?:[a-z]+:)?\/\//i.test(e)?e:[t,e].join("/").replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")}function p(e){return Object.keys(e).map(function(t){return e[t]?encodeURIComponent(t)+"="+encodeURIComponent(e[t]):t}).join("&")}function g(t){t||"undefined"==typeof window||(t=window);try{return t&&t.location?t.location.origin?t.location.origin:t.location.protocol+"//"+t.location.hostname+(t.location.port?":"+t.location.port:""):null}catch(e){return null}}var r={facebook:{name:"facebook",url:"/auth/facebook",redirectUri:g()+"/",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",additionalUrlParams:{display:"popup"},scope:["email"],scopeDelimiter:",",oauthType:"2.0",popupOptions:{width:580,height:400}},google:{name:"google",url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",additionalUrlParams:{display:"popup",prompt:undefined,login_hint:undefined,access_type:undefined,include_granted_scopes:undefined,"openid.realm":undefined,hd:undefined},scope:["openid","profile","email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:452,height:633},state:function(){return encodeURIComponent(Math.random().toString(36).substr(2))}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",scope:["user:email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}},instagram:{name:"instagram",url:"/auth/instagram",authorizationEndpoint:"https://api.instagram.com/oauth/authorize",scope:["basic"],scopeDelimiter:"+",oauthType:"2.0"},linkedin:{name:"linkedin",url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/uas/oauth2/authorization",scope:["r_emailaddress"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:527,height:582},state:"STATE"},twitter:{name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",oauthType:"1.0",popupOptions:{width:495,height:645}},twitch:{name:"twitch",url:"/auth/twitch",authorizationEndpoint:"https://api.twitch.tv/kraken/oauth2/authorize",scope:["user_read"],scopeDelimiter:" ",additionalUrlParams:{display:"popup"},oauthType:"2.0",popupOptions:{width:500,height:560}},live:{name:"live",url:"/auth/live",authorizationEndpoint:"https://login.live.com/oauth20_authorize.srf",additionalUrlParams:{display:"popup"},scope:["wl.emails"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:500,height:560}},yahoo:{name:"yahoo",url:"/auth/yahoo",authorizationEndpoint:"https://api.login.yahoo.com/oauth2/request_auth",scope:[],scopeDelimiter:",",oauthType:"2.0",popupOptions:{width:559,height:519}},bitbucket:{name:"bitbucket",url:"/auth/bitbucket",authorizationEndpoint:"https://bitbucket.org/site/oauth2/authorize",redirectUri:g()+"/",scope:["email"],scopeDelimiter:",",oauthType:"2.0",popupOptions:{width:1028,height:529}},spotify:{name:"spotify",url:"/auth/spotify",authorizationEndpoint:"https://accounts.spotify.com/authorize",scope:["","user-read-email"],scopeDelimiter:",",oauthType:"2.0",popupOptions:{width:500,height:530},state:function(){return encodeURIComponent(Math.random().toString(36).substr(2))}}},u=new n.InjectionToken("config.options"),y=function(){function t(t){this.options={withCredentials:!1,tokenRoot:null,baseUrl:"/",loginUrl:"/auth/login",signupUrl:"/auth/signup",unlinkUrl:"/auth/unlink/",tokenName:"token",tokenSeparator:"_",tokenPrefix:"ng2-ui-auth",authHeader:"Authorization",authToken:"Bearer",storageType:s.LOCAL_STORAGE,cordova:null,resolveToken:function(t,e){var o=t&&(t.access_token||t.token||t.data);if(!o)return null;if("string"==typeof o)return o;if("object"!=typeof o)return null;var r=e.tokenRoot&&e.tokenRoot.split(".").reduce(function(t,e){return t[e]},o),n=r?r[e.tokenName]:o[e.tokenName];return n||null},providers:{}},this.options=d({},this.options,t),this.mergeWithDefaultProviders()}return t.prototype.updateProviders=function(t){this.options.providers=d({},this.options.providers||{},t),this.mergeWithDefaultProviders()},t.prototype.mergeWithDefaultProviders=function(){var e=this;Object.keys(this.options.providers).forEach(function(t){t in r&&(e.options.providers[t]=d({},r[t],e.options.providers[t]))})},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:n.Inject,args:[u]}]}]},t}(),v=function I(){},m=function(o){function t(t){var e=o.call(this)||this;return e.config=t,e.store={},e.storageType=s.MEMORY,e.updateStorageType(t.options.storageType)||console.warn(t.options.storageType+" is not available."),e}return function r(t,e){function o(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}(t,o),t.prototype.updateStorageType=function(t){return!!this.checkIsStorageAvailable(t)&&(this.storageType=t,!0)},t.prototype.get=function(t){switch(this.storageType){case s.COOKIE:case s.SESSION_COOKIE:return this.getCookie(t);case s.LOCAL_STORAGE:case s.SESSION_STORAGE:return window[this.storageType].getItem(t);case s.MEMORY:return this.store[t];case s.NONE:default:return null}},t.prototype.set=function(t,e,o){switch(this.storageType){case s.COOKIE:case s.SESSION_COOKIE:this.setCookie(t,e,this.storageType===s.COOKIE?o:"");break;case s.LOCAL_STORAGE:case s.SESSION_STORAGE:window[this.storageType].setItem(t,e);break;case s.MEMORY:this.store[t]=e}},t.prototype.remove=function(t){switch(this.storageType){case s.COOKIE:case s.SESSION_COOKIE:this.removeCookie(t);break;case s.LOCAL_STORAGE:case s.SESSION_STORAGE:window[this.storageType].removeItem(t);break;case s.MEMORY:delete this.store[t]}},t.prototype.checkIsStorageAvailable=function(t){switch(t){case s.COOKIE:case s.SESSION_COOKIE:return this.isCookieStorageAvailable();case s.LOCAL_STORAGE:case s.SESSION_STORAGE:return this.isWindowStorageAvailable(t);case s.NONE:case s.MEMORY:return!0;default:return!1}},t.prototype.isWindowStorageAvailable=function(t){try{var e=window&&t in window&&null!==window[t];if(e){var o=Math.random().toString(36).substring(7);window[t].setItem(o,""),window[t].removeItem(o)}return e}catch(r){return!1}},t.prototype.isCookieStorageAvailable=function(){try{if(document&&"cookie"in document){var t=Math.random().toString(36).substring(7);this.setCookie(t,"test",new Date(Date.now()+6e4).toUTCString());var e=this.getCookie(t);return this.removeCookie(t),"test"===e}return!1}catch(o){return!1}},t.prototype.setCookie=function(t,e,o,r){void 0===o&&(o=""),void 0===r&&(r="/"),document.cookie=t+"="+e+(o?"; expires="+o:"")+"; path="+r},t.prototype.removeCookie=function(t,e){void 0===e&&(e="/"),this.setCookie(t,"",new Date(0).toUTCString(),e)},t.prototype.getCookie=function(t){return document.cookie.replace(new RegExp("(?:(?:^|.*;\\s*)"+t+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:y}]},t}(v),w=function(){function t(t,e){this.storage=t,this.config=e,this.tokenName=this.config.options.tokenPrefix?[this.config.options.tokenPrefix,this.config.options.tokenName].join(this.config.options.tokenSeparator):this.config.options.tokenName}return t.prototype.getToken=function(){return this.storage.get(this.tokenName)},t.prototype.getPayload=function(t){if(void 0===t&&(t=this.getToken()),t&&3===t.split(".").length)try{var e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(this.b64DecodeUnicode(e))}catch(o){return undefined}},t.prototype.setToken=function(t){var e;if(t&&(e="string"==typeof t?t:this.config.options.resolveToken(t,this.config.options))){var o=this.getExpirationDate(e);this.storage.set(this.tokenName,e,o?o.toUTCString():"")}},t.prototype.removeToken=function(){this.storage.remove(this.tokenName)},t.prototype.isAuthenticated=function(t){if(void 0===t&&(t=this.getToken()),t){if(3===t.split(".").length)try{var e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=JSON.parse(this.b64DecodeUnicode(e)).exp;if(o)return!(Math.round((new Date).getTime()/1e3)>=o)||(this.storage.remove(this.tokenName),!1)}catch(r){return!0}return!0}return!1},t.prototype.getExpirationDate=function(t){void 0===t&&(t=this.getToken());var e=this.getPayload(t);if(e&&e.exp&&Math.round((new Date).getTime()/1e3)<e.exp){var o=new Date(0);return o.setUTCSeconds(e.exp),o}return null},t.prototype.logout=function(){var e=this;return c.Observable.create(function(t){e.storage.remove(e.tokenName),t.next(),t.complete()})},t.prototype.setStorageType=function(t){return this.storage.updateStorageType(t)},t.prototype.b64DecodeUnicode=function(t){return decodeURIComponent(Array.prototype.map.call(atob(t),function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""))},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:v},{type:y}]},t}(),O=function(){function t(t,e){this.shared=t,this.config=e}return t.prototype.intercept=function(t,e){var o,r=this.config.options,n=r.authHeader,i=r.authToken,a=this.shared.getToken(),s=this.shared.isAuthenticated()&&!t.headers.has(n)?t.clone({setHeaders:(o={},o[n]=i+" "+a,o)}):t;return e.handle(s)},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:w},{type:y}]},t}(),k=function(){function t(){}return t.prototype.open=function(t,e,o){var r=this.stringifyOptions(this.prepareOptions(e.popupOptions)),n=(window.navigator.userAgent,(o=null===o?this.isCordovaApp():o)?"_blank":e.name),i="undefined"!=typeof window?window.open(t,n,r):null;return i?(i.focus&&i.focus(),o?this.eventListener(i,e.redirectUri||g()):this.pollPopup(i,e.redirectUri||g())):c.empty()},t.prototype.eventListener=function(s,p){var u=this;if(!s)throw new Error("Popup was not created");return c.merge(c.fromEvent(s,"exit").pipe(h.delay(100),h.map(function(){throw new Error("Authentication Canceled")})),c.fromEvent(s,"loadstart")).pipe(h.switchMap(function(t){if(!s||s.closed)return c.Observable["throw"](new Error("Authentication Canceled"));if(0!==t.url.indexOf(p))return c.empty();var e=document.createElement("a");if(e.href=t.url,e.search||e.hash){var o=e.search.substring(1).replace(/\/$/,""),r=e.hash.substring(1).replace(/\/$/,""),n=u.parseQueryString(r),i=u.parseQueryString(o),a=d({},i,n);if(s.close(),a.error)throw a.error;return c.of(a)}return c.empty()}),h.take(1))},t.prototype.pollPopup=function(a,s){var p=this;return c.interval(50).pipe(h.switchMap(function(){if(!a||a.closed)return c.throwError(new Error("Authentication Canceled"));var t=g(a);if(!t||0!==s.indexOf(t)&&0!==t.indexOf(s)||!a.location.search&&!a.location.hash)return c.empty();var e=a.location.search.substring(1).replace(/\/$/,""),o=a.location.hash.substring(1).replace(/[\/$]/,""),r=p.parseQueryString(o),n=p.parseQueryString(e);a.close();var i=d({},n,r);if(i.error)throw i.error;return c.of(i)}),h.take(1))},t.prototype.prepareOptions=function(t){var e=(t=t||{}).width||500,o=t.height||500;return d({width:e,height:o,left:window.screenX+(window.outerWidth-e)/2,top:window.screenY+(window.outerHeight-o)/2.5,toolbar:t.visibleToolbar?"yes":"no"},t)},t.prototype.stringifyOptions=function(e){return Object.keys(e).map(function(t){return null===e[t]||e[t]===undefined?t:t+"="+e[t]}).join(",")},t.prototype.parseQueryString=function(t){var o;return t.split("&").reduce(function(t,e){return e&&(o=e.split("="),t[decodeURIComponent(o[0])]="undefined"==typeof o[1]||decodeURIComponent(o[1])),t},{})},t.prototype.isCordovaApp=function(){return!(!window||!(window.cordova||window.navigator&&window.navigator.userAgent&&-1<window.navigator.userAgent.indexOf("CriOS")))},t.decorators=[{type:n.Injectable}],t}(),S=function(){function t(t,e,o){this.http=t,this.popup=e,this.config=o}return t.prototype.open=function(r,n){var i=this,t=this.config.options.baseUrl?f(this.config.options.baseUrl,r.url):r.url;return this.http.post(t,r).pipe(h.switchMap(function(e){return i.popup.open([r.authorizationEndpoint,p(e)].join("?"),r,i.config.options.cordova).pipe(h.map(function(t){return{authorizationData:e,oauthData:t}}))}),h.switchMap(function(t){var e=t.authorizationData,o=t.oauthData;return i.exchangeForToken(r,e,o,n)}))},t.prototype.exchangeForToken=function(t,e,o,r){var n={oauthOptions:t,authorizationData:e,oauthData:o,userData:r},i=this.config.options,a=i.withCredentials,s=i.baseUrl,p=t.method,u=void 0===p?"POST":p,c=t.url,h=s?f(s,c):c;return this.http.request(u,h,{body:n,withCredentials:a})},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:i.HttpClient},{type:k},{type:y}]},t}(),T=function(){function t(t,e,o){this.http=t,this.popup=e,this.config=o}return t.prototype.open=function(e,o){var r=this,n=this.getAuthorizationData(e),t=[e.authorizationEndpoint,p(n)].join("?");return this.popup.open(t,e,this.config.options.cordova).pipe(h.switchMap(function(t){if("token"===e.responseType||!e.url)return c.of(t);if(t.state&&t.state!==n.state)throw new Error('OAuth "state" mismatch');return r.exchangeForToken(e,n,t,o)}))},t.prototype.exchangeForToken=function(t,e,o,r){var n={authorizationData:e,oauthData:o,userData:r},i=this.config.options,a=i.baseUrl,s=i.withCredentials,p=t.url,u=t.method,c=void 0===u?"POST":u,h=a?f(a,p):p;return this.http.request(c,h,{body:n,withCredentials:s})},t.prototype.getAuthorizationData=function(t){var e=t.responseType,o=void 0===e?"code":e,r=t.clientId,n=t.redirectUri,i=void 0===n?g()||"":n,a=t.scopeDelimiter,s=void 0===a?",":a,p=t.scope,u=t.state,c=t.additionalUrlParams,h="function"==typeof u?u():u;return l([["response_type",o],["client_id",r],["redirect_uri",i]],u?[["state",h]]:[],p?[["scope",p.join(s)]]:[],c?Object.keys(c).map(function(t){var e=c[t];return"string"==typeof e?[t,e]:"function"==typeof e?[t,e()]:null===e?[t,""]:["",""]}):[]).filter(function(t){return!!t[0]}).reduce(function(t,e){var o;return d({},t,((o={})[e[0]]=e[1],o))},{})},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:i.HttpClient},{type:k},{type:y}]},t}(),b=function(){function t(t,e,o,r){this.http=t,this.shared=e,this.config=o,this.popup=r,this.depProviders=[{provide:i.HttpClient,useValue:this.http},{provide:k,useValue:this.popup},{provide:y,useValue:this.config}],this.deps=[i.HttpClient,k,y]}return t.prototype.authenticate=function(e,t){var o=this;return("1.0"===this.config.options.providers[e].oauthType?n.Injector.create(l(this.depProviders,[{provide:S,deps:this.deps}])).get(S):n.Injector.create(l(this.depProviders,[{provide:T,deps:this.deps}])).get(T)).open(this.config.options.providers[e],t||{}).pipe(h.tap(function(t){o.config.options.providers[e].url&&o.shared.setToken(t)}))},t.prototype.unlink=function(t,e,o){return void 0===e&&(e=f(this.config.options.baseUrl,this.config.options.unlinkUrl)),void 0===o&&(o="POST"),this.http.request(o,e,{body:{provider:t}})},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:i.HttpClient},{type:w},{type:y},{type:k}]},t}(),C=function(){function t(t,e,o){this.http=t,this.shared=e,this.config=o}return t.prototype.login=function(t,e){var o=this;return this.http.post(e||f(this.config.options.baseUrl,this.config.options.loginUrl),t).pipe(h.tap(function(t){return o.shared.setToken(t)}))},t.prototype.signup=function(t,e){return this.http.post(e||f(this.config.options.baseUrl,this.config.options.signupUrl),t)},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:i.HttpClient},{type:w},{type:y}]},t}(),E=function(){function t(t,e,o){this.shared=t,this.local=e,this.oauth=o}return t.prototype.login=function(t,e){return this.local.login(t,e)},t.prototype.signup=function(t,e){return this.local.signup(t,e)},t.prototype.logout=function(){return this.shared.logout()},t.prototype.authenticate=function(t,e){return this.oauth.authenticate(t,e)},t.prototype.link=function(t,e){return this.oauth.authenticate(t,e)},t.prototype.unlink=function(t,e){return this.oauth.unlink(t,e)},t.prototype.isAuthenticated=function(){return this.shared.isAuthenticated()},t.prototype.getToken=function(){return this.shared.getToken()},t.prototype.setToken=function(t){this.shared.setToken(t)},t.prototype.removeToken=function(){this.shared.removeToken()},t.prototype.getPayload=function(){return this.shared.getPayload()},t.prototype.setStorageType=function(t){return this.shared.setStorageType(t)},t.prototype.getExpirationDate=function(){return this.shared.getExpirationDate()},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:w},{type:C},{type:b}]},t}(),e=function(){function o(){}return o.forRoot=function(t,e){return void 0===e&&(e=!0),{ngModule:o,providers:l(t?[{provide:u,useValue:t}]:[],[{provide:y,useClass:y,deps:[u]},{provide:v,useClass:m,deps:[y]},{provide:w,useClass:w,deps:[v,y]},{provide:C,useClass:C,deps:[i.HttpClient,w,y]},{provide:k,useClass:k,deps:[y]},{provide:b,useClass:b,deps:[i.HttpClient,w,y,k]},{provide:E,useClass:E,deps:[w,C,b]}],e?[{provide:i.HTTP_INTERCEPTORS,useClass:O,multi:!0,deps:[w,y]}]:[])}},o.decorators=[{type:n.NgModule,args:[{imports:[i.HttpClientModule],declarations:[],exports:[]}]}],o}();t.Ng2UiAuthModule=e,t.LocalService=C,t.Oauth2Service=T,t.Oauth1Service=S,t.PopupService=k,t.OauthService=b,t.SharedService=w,t.StorageService=v,t.BrowserStorageService=m,t.AuthService=E,t.ConfigService=y,t.JwtInterceptor=O,t.CONFIG_OPTIONS=u,t.StorageType=s,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ng2-ui-auth.umd.min.js.map